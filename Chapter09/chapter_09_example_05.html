<html lang="en">
<head>
  <title>Music Generation With Magenta.js - Web Workers example</title>
  <style>
    * {
      font-family: monospace;
    }

    canvas {
      width: 100%;
    }
  </style>
</head>
<body>
<h1>Music Generation With Magenta.js - Web Workers example</h1>
<div>
  <p>
    Press "Sample MusicVAE trio" to sample a new sequence of a trio of
    instruments (drum kit, bass, lead) using MusicVAE in a Web Worker and
    plays it immediately.
  </p>
  <p>
    Reload the page to stop.
  </p>
  <p>
    <button disabled id="button-sample-musicae-trio">
      Sample MusicVAE trio
    </button>
  </p>
</div>
<script
    src="https://cdn.jsdelivr.net/npm/@magenta/music@1.12.0/dist/magentamusic.js"></script>
<script>
  // Get DOM elements
  const buttonSampleMusicVaeTrio = document
      .getElementById("button-sample-musicae-trio");

  // TODO worker
  const worker = new Worker("chapter_09_example_05.js");
  worker.onmessage = function (event) {
    const message = event.data[0];
    if (message === "initialized") {
      // TODO worker
      buttonSampleMusicVaeTrio.disabled = false;
    }
    if (message === "sample") {
      // TODO worker
      const data = event.data[1];
      const sample = data[0];
      const player = new mm.Player();
      mm.Player.tone.Transport.loop = true;
      mm.Player.tone.Transport.loopStart = 0;
      mm.Player.tone.Transport.loopEnd = 8;
      player.start(sample, 120);
    }
  };

  // TODO add onclick handler to call the MusicVAE sampling
  buttonSampleMusicVaeTrio.addEventListener("click", (event) => {
    worker.postMessage([]);
    event.target.disabled = true;
  });
</script>
</body>
</html>